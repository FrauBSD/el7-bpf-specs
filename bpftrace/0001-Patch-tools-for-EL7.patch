From ee00f39c92355f41e3ead413e26c244fc64fa481 Mon Sep 17 00:00:00 2001
From: bas smit <bsmit@hostnet.nl>
Date: Sun, 30 Jun 2019 12:41:22 +0200
Subject: [PATCH] Patch tools for EL7

---
 tools/execsnoop.bt      |  5 +++--
 tools/gethostlatency.bt | 13 +++++++------
 2 files changed, 10 insertions(+), 8 deletions(-)

diff --git a/tools/execsnoop.bt b/tools/execsnoop.bt
index 357f09d..a5103f0 100755
--- a/tools/execsnoop.bt
+++ b/tools/execsnoop.bt
@@ -13,6 +13,7 @@
  *
  * 15-Nov-2017	Brendan Gregg	Created this.
  * 11-Sep-2018	   "     "	Switched to use join().
+ * 30-Jun-2019  Bas Smit  Use kprobe for EL7 support
  */
 
 BEGIN
@@ -20,8 +21,8 @@ BEGIN
 	printf("%-10s %-5s %s\n", "TIME(ms)", "PID", "ARGS");
 }
 
-tracepoint:syscalls:sys_enter_execve
+kprobe:SyS_execve
 {
 	printf("%-10u %-5d ", elapsed / 1000000, pid);
-	join(args->argv);
+	join(arg1);
 }
diff --git a/tools/gethostlatency.bt b/tools/gethostlatency.bt
index a1ac1b2..435b519 100755
--- a/tools/gethostlatency.bt
+++ b/tools/gethostlatency.bt
@@ -26,17 +26,17 @@ BEGIN
 	    "HOST");
 }
 
-uprobe:/lib/x86_64-linux-gnu/libc.so.6:getaddrinfo,
-uprobe:/lib/x86_64-linux-gnu/libc.so.6:gethostbyname,
-uprobe:/lib/x86_64-linux-gnu/libc.so.6:gethostbyname2
+uprobe:/usr/lib64/libc.so.6:getaddrinfo,
+uprobe:/usr/lib64/libc.so.6:gethostbyname,
+uprobe:/usr/lib64/libc.so.6:gethostbyname2
 {
 	@start[tid] = nsecs;
 	@name[tid] = arg0;
 }
 
-uretprobe:/lib/x86_64-linux-gnu/libc.so.6:getaddrinfo,
-uretprobe:/lib/x86_64-linux-gnu/libc.so.6:gethostbyname,
-uretprobe:/lib/x86_64-linux-gnu/libc.so.6:gethostbyname2
+uretprobe:/usr/lib64/libc.so.6:getaddrinfo,
+uretprobe:/usr/lib64/libc.so.6:gethostbyname,
+uretprobe:/usr/lib64/libc.so.6:gethostbyname2
 /@start[tid]/
 {
 	$latms = (nsecs - @start[tid]) / 1000000;
@@ -45,3 +45,4 @@ uretprobe:/lib/x86_64-linux-gnu/libc.so.6:gethostbyname2
 	delete(@start[tid]);
 	delete(@name[tid]);
 }
+
-- 
2.22.0

